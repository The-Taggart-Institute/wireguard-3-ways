<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>About - Wireguard 3 Ways: Cooking up Privacy in a Surveillance State</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Wireguard 3 Ways: Cooking up Privacy in a Surveillance State</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="wireguard-3-ways-cooking-up-security-in-a-surveillance-state"><a class="header" href="#wireguard-3-ways-cooking-up-security-in-a-surveillance-state">Wireguard 3 Ways: Cooking Up Security in a Surveillance State</a></h1>
<p>This repository contains instructions and support files for the <a href="https://hope.net">HOPE</a> workshop.</p>
<h2 id="learning-objectives"><a class="header" href="#learning-objectives">Learning Objectives</a></h2>
<p>We break learning objectives into <strong>Skills</strong> and <strong>Concepts</strong>.</p>
<h3 id="skills"><a class="header" href="#skills">Skills</a></h3>
<p>By the end of this workshop, participants will be able to:</p>
<ul>
<li>Create Wireguard peers and servers</li>
<li>Establish Wireguard networks across NAT boundaries</li>
</ul>
<h3 id="concepts"><a class="header" href="#concepts">Concepts</a></h3>
<p>By the end of this workshop, participants will understand:</p>
<ul>
<li>Wireguard tunnel design</li>
<li>Wireguard asymmetric cryptography usage</li>
<li>Wireguard networking strategies</li>
<li>Basic mesh networking principals</li>
</ul>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<h3 id="technical-requirements"><a class="header" href="#technical-requirements">Technical Requirements</a></h3>
<p>If you want to connect to the pre-built lab environment, you'll need to install <a href="https://tailscale.com/download">Tailscale</a>. We won't use the Tailscale service directly; instead, we will use the very open source tools discussed in the workshop to connect to the lab. So meta!</p>
<p>Instructions for connecting will be provided at the workshop.</p>
<p>This workshop uses <a href="https://podman.io">Podman</a> for its demonstrations. It can be installed on Linux, Windows or macOS. On Windows, Podman Desktop will require either <a href="https://learn.microsoft.com/en-us/windows/wsl/install">WSL</a> or Hyper-V to virtualize a small Linux kernel. We will also use Podman Compose, which is a package install for Linux, but <a href="https://podman-desktop.io/docs/compose">Podman Desktop</a> can support this function as well.</p>
<p>The workshop will also use <a href="https://zellij.dev">Zellij</a> for easy terminal control of the containers. If not participating with the provided resources, I recommend installing it.</p>
<p>The containers will have several terminal-based text editors installed (Vim, Nano, Helix) to suit your preference. But you will be editing text in the terminal.</p>
<h3 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h3>
<p>Familiarity with the Linux command line will be extremely helpful in this workshop. As will familiarity with basic networking concepts such as subnets and firewall rules.</p>
<h3 id="cloud-vm"><a class="header" href="#cloud-vm">Cloud VM</a></h3>
<p>The Recipes provided in this repository are wholly self-contained. You can run them on any platform that supports Podman/Podman Compose. However, for full participation in the workshop, you will need two resources I can't provide for you:</p>
<ol>
<li>A registered domain name</li>
<li>A cloud-hosted virtual machine</li>
</ol>
<p>These are not zero-cost, zero-identity activities, and as such are optional. However, the workshop will involve demonstrating how to set up a real Wireguard network for use across the internet, which means public-facing assets. If you intend to fully participate in the workshop, these will be necessary.</p>
<p>I recommend <a href="https://porkbun.com">Porkbun</a> or <a href="https://namecheap.com">Namecheap</a> for a domain registrar, and <a href="https://digitalocean.com">Digital Ocean</a> for a VPS provider.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>Here are provided 3 "recipes" for creating Wireguard networks, in increasing complexity‚Äîand utility. Each is comprised of <a href="https://podman.io">Podman</a> containers, networked together. They can be run on any platform that Podman supports, but for the HOPE workshop, a cloud VM will be provided for participants.</p>
<h3 id="zellij"><a class="header" href="#zellij">Zellij</a></h3>
<p>The recipes provded each have a startup script that performs some housekeeping on the Podman containers. It also launches a helper terminal multiplexer called <a href="https://zellij.dev">Zellij</a>. If you aren't using the provided resources, I recommend installing Zellij to make full use of the environment.</p>
<p>Zellij will create terminal windows for all necessary containers, as well as a separate window for interacting with the host itself. Zellij is mouse-sensitive and fairly intuitive‚Äîwell, for a terminal tool.</p>
<h2 id="the-recipes"><a class="header" href="#the-recipes">The Recipes</a></h2>
<p>I know it says "3 ways" on the box, but actually we need to start with a fundamental dish before moving on to the real recipes.</p>
<h3 id="0-a-simple-mesh"><a class="header" href="#0-a-simple-mesh">0. A Simple Mesh</a></h3>
<p>In this recipe, all our peers live on the same network. That could make Wireguard redundant, but it will establish an additional layer of encryption on top of all peer-to-peer communications. This recipe is more about learning the concepts of Wireguard configurations. Each peer connects to every other peer via manual point-to-point connections. This works, but doesn't exactly scale.</p>
<h3 id="1-the-lighthouse"><a class="header" href="#1-the-lighthouse">1. The Lighthouse</a></h3>
<p>If we want to connect multiple hosts across networks, but we don't want to open inbound ports, we need to use a public server that all our peers can see. This "lighthouse" server will be the one to which all the others connect.</p>
<h3 id="2-the-lighthouse--subnet-router"><a class="header" href="#2-the-lighthouse--subnet-router">2. The Lighthouse + Subnet Router</a></h3>
<p>What if we want access to an entire home network without wanting to configure Wireguard on all of those devices? That's where "subnet routers" come in. This configuration allows a (Linux) Wireguard host to provide access to its neighbors through the Wireguard tunnel.</p>
<h3 id="3-the-coordinated-mesh"><a class="header" href="#3-the-coordinated-mesh">3. The Coordinated Mesh</a></h3>
<p>One of the shortcomings of the "lighthouse" model is that the lighthouse becomes a termination point for the Wireguard encrypted tunnel. If we have doubts about our cloud service provider, then any otherwise unencrypted traffic may be sniffed with access to this server. But we need a central point that everyone can see to guarantee connection. How to square this circle?</p>
<p><a href="https://tailscale.com">Tailscale</a> solves this problem by using multiple strategies to show peers how to connect, and then allows the peers to connect directly to each other, eliminating the machine-in-the-middle. And it's all built on top of Wireguard, so you get the same security with much less hassle.</p>
<p>But Tailscale is a cloud service. So suppose you didn't want to entrust your data there either? Luckily, the core of Tailscale is open source‚Äîboth client daemon and server. <a href="https://headscale.net">Headscale</a> is a way to self-host a Tailscale server and network. The setup for Headscale is <em>considerably</em> easier than raw Wireguard.</p>
<h2 id="how-to-use-this-repo"><a class="header" href="#how-to-use-this-repo">How to Use This Repo</a></h2>
<p>The source of this repo is fully readable here, but the online "book" version for easy reading is online at <a href="https://w3w.taggartinstitute.org">https://w3w.taggartinstitute.org</a>.</p>
<p>Read along and follow the provide instructions to participate in the workshop!</p>
<h2 id="instructions"><a class="header" href="#instructions">Instructions</a></h2>
<p>See the <a href="docs/SUMMARY.html">docs</a> folder for the instructions. Or click next if you're reading the book!</p>
<blockquote>
<center><i>Made with üíú by <a href="https://taggartinstitute.org">The Taggart Institute</a></i></center>
<center><img src="logo.png" style="width: 250px; height: 250px; margin-top: 5px;" /></center>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next prefetch" href="whyreguard.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next prefetch" href="whyreguard.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>



    </div>
    </body>
</html>
